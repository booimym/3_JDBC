<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
<comment>book-query.xml</comment>


<entry key = "selectByBranch">
<![CDATA[
SELECT ALL_MOVIES_NO,THEATER_NM, SCREEN_NAME, MOVIE_TITLE,TO_CHAR(START_TIME,'HH24" : "MI') "상영시간",(8-COUNT(*)) "남은 좌석 개수"
FROM RESERVATION
JOIN TIMETABLE T USING (ALL_MOVIES_NO)
JOIN THEATER H ON (T.THEATER_NO = H.THEATER_NO)
JOIN SCREEN S ON (T.SCREEN_NO = S.SCREEN_NO)
JOIN MOVIE USING(MOVIE_NO)
WHERE THEATER_NM = ?
AND (TO_NUMBER(TO_CHAR(SYSDATE,'HH24')) < TO_NUMBER(TO_CHAR(START_TIME,'HH24'))
	 OR (TO_NUMBER(TO_CHAR(SYSDATE,'HH24')) = TO_NUMBER(TO_CHAR(START_TIME,'HH24'))
		AND TO_NUMBER(TO_CHAR(SYSDATE,'MI')) = TO_NUMBER(TO_CHAR(START_TIME,'MI'))))
GROUP BY ALL_MOVIES_NO,THEATER_NM,SCREEN_NAME,MOVIE_TITLE,TO_CHAR(START_TIME,'HH24" : "MI')]]>
</entry>

<entry key = "selectByMovie">
<![CDATA[
SELECT  ALL_MOVIES_NO ,THEATER_NM, SCREEN_NAME, MOVIE_TITLE,TO_CHAR(START_TIME,'HH24" : "MI') "상영시간", (8-COUNT(*)) "남은 좌석 개수"
FROM RESERVATION
JOIN TIMETABLE T USING (ALL_MOVIES_NO)
JOIN THEATER H ON (T.THEATER_NO = H.THEATER_NO)
JOIN SCREEN S ON (T.SCREEN_NO = S.SCREEN_NO)
JOIN MOVIE USING (MOVIE_NO)
WHERE MOVIE_TITLE = ?
AND (TO_NUMBER(TO_CHAR(SYSDATE,'HH24')) < TO_NUMBER(TO_CHAR(START_TIME,'HH24'))
	 OR (TO_NUMBER(TO_CHAR(SYSDATE,'HH24')) = TO_NUMBER(TO_CHAR(START_TIME,'HH24'))
		AND TO_NUMBER(TO_CHAR(SYSDATE,'MI')) = TO_NUMBER(TO_CHAR(START_TIME,'MI'))))
GROUP BY ALL_MOVIES_NO,THEATER_NM, SCREEN_NAME, MOVIE_TITLE,TO_CHAR(START_TIME,'HH24" : "MI')]]>
</entry>

<entry key = "checkRating">
SELECT COUNT(*)
FROM TIMETABLE
JOIN MOVIE USING (MOVIE_NO)
WHERE RATING LIKE '청소년%' AND ALL_MOVIES_NO = ?
</entry>

<entry key = "leftSeat">
SELECT(8-COUNT(*))
FROM RESERVATION
WHERE ALL_MOVIES_NO = ?
</entry>


<entry key ="checkSeat">
SELECT COUNT(*)
FROM RESERVATION
WHERE ALL_MOVIES_NO = ?
AND SEAT_NO = ?
</entry>

<entry key = "booking">
INSERT INTO RESERVATION 
VALUES (SEQ_RESERV_NO.NEXTVAL,?,?,?,0)
</entry>

<entry key = "checkBooking">
SELECT RESERV_NO, ALL_MOVIES_NO, MOVIE_TITLE, THEATER_NM, SCREEN_NAME , TO_CHAR(START_TIME,'HH24" : "MI') "상영시간" ,SEAT_NAME
FROM RESERVATION
JOIN TIMETABLE T USING (ALL_MOVIES_NO)
JOIN THEATER H ON (T.THEATER_NO = H.THEATER_NO)
JOIN SCREEN S ON (T.SCREEN_NO = S.SCREEN_NO)
JOIN MOVIE USING(MOVIE_NO)
JOIN SEAT USING (SEAT_NO)
JOIN MEMBER USING (MEMBER_NO)
WHERE MEMBER_ID = ? AND MEMBER_PW = ?
</entry>

<entry key = "deleteBooking">
DELETE 
FROM (SELECT MEMBER_ID, MEMBER_PW, RESERV_NO FROM RESERVATION 
JOIN "MEMBER" USING (MEMBER_NO))
WHERE MEMBER_ID = ? AND MEMBER_PW = ? AND RESERV_NO = ?
</entry>

</properties>
